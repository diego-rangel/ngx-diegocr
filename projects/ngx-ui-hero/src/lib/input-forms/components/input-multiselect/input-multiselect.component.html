<div [id]="identifier" class="ui-multiselect" (clickOutside)="ToggleDropDown(false)">
    <label *ngIf="label">
        {{label}}
        <span class="required-symbol" *ngIf="isRequired"> *</span>
        <i class="fa fa-question-circle ml-2" tooltip="{{help}}" container="body" *ngIf="help"></i>
    </label>

    <input type="hidden" [(ngModel)]="value" />
    <div class="combobox d-flex align-items-center justify-content-between" 
        [ngClass]="{
            'open': showOptions, 
            'disabled': disabled,
            'is-valid': comboTouched && (!isRequired || value?.length > 0),
            'is-invalid': comboTouched && isRequired && (!value || value.length == 0)
        }"
        (click)="ToggleDropDown()">

        <span *ngIf="!value || value.length == 0">{{placeholder}}</span>

        <div *ngIf="value?.length > 0" class="selected-items d-flex align-items-center">
            <span class="badge" *ngFor="let item of value | slice:0:maxCountOfLabelsToShow; let i = index;" (click)="RemoveItem(item, i, $event)">
                <span class="text-truncate">{{item[displayTextProperty]}}</span>
                <i class="fa fa-times ml-2" *ngIf="!disabled"></i>
            </span>
            <span *ngIf="value.length > maxCountOfLabelsToShow">...</span>
        </div>

        <i class="fa" [ngClass]="{'fa-caret-down': !showOptions, 'fa-caret-up': showOptions}"></i>
    </div>

    <div class="dropdown-options shadow fadeInDown" *ngIf="showOptions">
        <div class="options-container" *ngIf="options?.length > 0">
            <div class="toolbar d-flex align-items-center">
                <input type="text" class="form-control" name="{{identifier}}-search" [(ngModel)]="search" placeholder="{{searchPlaceholder}}" />
                <button type="button" class="btn btn-light ml-1" (click)="ToggleAllItemsSelection(true)" [disabled]="disabled"><i class="fa fa-check-square"></i> {{selectAllButtonLabel}}</button>
                <button type="button" class="btn btn-light ml-1" (click)="ToggleAllItemsSelection(false)" [disabled]="disabled"><i class="fa fa-eraser"></i> {{clearSelectionButtonLabel}}</button>
            </div>

            <ul>
                <li class="d-flex" *ngFor="let item of options | searchBy : displayTextProperty : search" [ngClass]="{'selected': item.selected}">
                    <div class="checkbox mr-3">
                        <input type="checkbox" name="{{identifier}}-option" [(ngModel)]="item.selected" (change)="ItemSelectedCheckChanged()" [disabled]="disabled" />
                    </div>
                    <span class="link" (click)="ToggleItemSelected(item)">{{item[displayTextProperty]}}</span>
                </li>
            </ul>

            <small class="empty-results" *ngIf="(options | searchBy : displayTextProperty : search).length == 0">{{emptyMessage}}</small>
        </div>

        <small class="empty-results" *ngIf="!options || options.length == 0">{{emptyMessage}}</small>
    </div>
</div>

<small class="text-muted" *ngIf="description">{{description}}</small>
